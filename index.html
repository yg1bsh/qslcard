<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>YG1BSH - Index</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/yg1bsh_logo.png" rel="icon">
  <link href="assets/img/yg1bsh1.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@700;900&family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,600;1,700&family=Poppins:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Inter:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: Logis
  * Updated: Aug 30 2023 with Bootstrap v5.3.1
  * Template URL: https://bootstrapmade.com/logis-bootstrap-logistics-website-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->

  <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.debug.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script> -->

  <script>
    
    $(function() {
        // $("#includeHeader").load("header.html");
       $("#includeFooter").load("footer.html");
    });
 </script>
</head>

<body>

  <!-- <div w3-include-html="header.html"></div> -->

  <!-- ======= Header ======= -->
  <!-- <div id="includeHeader"></div> -->
  
<header id="header" class="header d-flex align-items-center fixed-top">
  <div class="container-fluid container-xl d-flex align-items-center justify-content-between">

    <a href="index.html" class="logo d-flex align-items-center">
      <!-- Uncomment the line below if you also wish to use an image logo -->
      <img src="assets/img/yg1bsh_logo.png" alt="">
      <h1>YG1BSH</h1>
    </a>

    <!-- <i class="mobile-nav-toggle mobile-nav-show bi bi-list"></i>
    <i class="mobile-nav-toggle mobile-nav-hide d-none bi bi-x"></i> -->
    
    <!-- <nav id="navbar" class="navbar">
      <ul>
        <li><a href="index.html" class="active">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="services.html">Services</a></li>
        <li><a href="pricing.html">Pricing</a></li>
        <li class="dropdown"><a href="#"><span>Drop Down</span> <i class="bi bi-chevron-down dropdown-indicator"></i></a>
          <ul>
            <li><a href="#">Drop Down 1</a></li>
            <li class="dropdown"><a href="#"><span>Deep Drop Down</span> <i class="bi bi-chevron-down dropdown-indicator"></i></a>
              <ul>
                <li><a href="#">Deep Drop Down 1</a></li>
                <li><a href="#">Deep Drop Down 2</a></li>
                <li><a href="#">Deep Drop Down 3</a></li>
                <li><a href="#">Deep Drop Down 4</a></li>
                <li><a href="#">Deep Drop Down 5</a></li>
              </ul>
            </li>
            <li><a href="#">Drop Down 2</a></li>
            <li><a href="#">Drop Down 3</a></li>
            <li><a href="#">Drop Down 4</a></li>
          </ul>
        </li>
        <li><a href="contact.html">Contact</a></li>
        <li><a class="get-a-quote" href="get-a-quote.html">Get a Quote</a></li>
      </ul>
    </nav> -->
    <!-- .navbar -->

  </div>
</header><!-- End Header -->
<!-- End Header -->

  <!-- ======= Hero Section ======= -->
  <section id="hero" class="hero d-flex align-items-center">
    <div class="container">
      <div class="row gy-4 d-flex justify-content-between">
        <div class="col-lg-6 order-2 order-lg-1 d-flex flex-column justify-content-center">
          <h2 data-aos="fade-up">Find Your QSL</h2>
          <p data-aos="fade-up" data-aos-delay="100" id="note">Nice to QSO with you</p>

          <form action="#dataqso" class="form-search d-flex align-items-stretch mb-3" data-aos="fade-up" data-aos-delay="200">
            <input type="text" class="form-control" style="text-transform: uppercase; font-size: 36px; font-weight: bold; color: blue" id="callsign" name="callsign" placeholder="your callsign">
            <button type="submit" class="btn btn-primary" id="btnSearch">Search</button>
          </form>

          <div class="row gy-4" data-aos="fade-up" data-aos-delay="400">

            <div class="col-lg-3 col-6">
              <div class="stats-item text-center w-100 h-100">
                <!-- <span data-purecounter-start="0" data-purecounter-end="165" id="dataDXCC" data-purecounter-duration="1" class="purecounter"></span> -->
                <span id="dataDXCC"></span>
                <p>DXCC</p>
              </div>
            </div><!-- End Stats Item -->

            <div class="col-lg-3 col-6">
              <div class="stats-item text-center w-100 h-100">
                <!-- <span data-purecounter-start="0" data-purecounter-end="3202" data-purecounter-duration="1" class="purecounter"></span> -->
                <span id="dataQSO"></span>
                <p>QSO</p>
              </div>
            </div><!-- End Stats Item -->

            <div class="col-lg-3 col-6">
              <div class="stats-item text-center w-100 h-100">
                <!-- <span data-purecounter-start="0" data-purecounter-end="2950" data-purecounter-duration="1" class="purecounter"></span> -->
                <span id="dataCallsign"></span>
                <p>Confirmed</p>
              </div>
            </div><!-- End Stats Item -->

            <!-- <div class="col-lg-2 col-6">
              <div class="stats-item text-center w-100 h-100">
                <span id="dataMode"></span>
                <p>Mode</p>
              </div>
            </div>

            <div class="col-lg-2 col-6">
              <div class="stats-item text-center w-100 h-100">
                <span id="dataBand"></span>
                <p>Band</p>
              </div>
            </div> -->

          </div>
        </div>

        <div class="col-lg-5 order-1 order-lg-2 hero-img" data-aos="zoom-out">
          <!-- <img src="assets/img/hero-img.svg" class="img-fluid mb-3 mb-lg-0" alt=""> -->
          <img src="assets/img/yg1bsh2.png" class="img-fluid mb-3 mb-lg-0" alt="">
        </div>

      </div>
    </div>
  </section><!-- End Hero Section -->

  <main id="main">

    

    
    <!-- ======= Horizontal Pricing Section ======= -->
    <section id="dataqso" class="horizontal-pricing pt-0">
        <div class="container" data-aos="fade-up">
  
          <div class="section-header">
            <span id="qsodataspan">QSO Data</span>
            <h2 id="qsodatahead">QSO Data</h2>
            <h3 id="callsignData"></h3>
          </div>
          <!-- <div id="callsignData" class="pt-0"></div> -->
          <div id="qsoDetail"></div>
          
  
        </div>
      </section><!-- End Horizontal Pricing Section -->


    <!-- ======= QSO Section ======= -->
    <!-- <section id="qso" class="pricing pt-0">
        <div class="container" data-aos="fade-up">
  
          <div class="section-header">
            <span>Logger</span>
            <h2>Logger</h2>
  
          </div>
  
          <div class="row gy-4">
  
            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="100">
              <div class="pricing-item">
                <iframe align="top" frameborder="0" height="650" scrolling="yes" src="https://logbook.qrz.com/lbstat/YG1BSH/" width="100%"></iframe>

                <a href="https://www.qrz.com/db/yg1bsh" class="buy-btn" target="_blank">To qrz.com page</a>
              </div>
            </div>
  
            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="200">
              <div class="pricing-item featured">
                <iframe height="650" scrolling="auto" src="https://www.hrdlog.net/hrdlogframe.aspx?user=YG1BSH&amp;lastqso=20&amp;qsomap=&amp;options=search;disablelinks;" width="100%"></iframe>
                <a href="#" class="buy-btn">To hrdlog.net page</a>
              </div>
            </div>
          </div>
  
        </div>
    </section> -->


  </main><!-- End #main -->


  <div id="qrcode"></div>

  <!-- ======= Footer ======= -->
  <!-- <div id="includeFooter"></div> -->

  <!-- ======= Footer ======= -->
<footer id="footer" class="footer">
    <div class="container" style="text-align: center;">
      <div class="row gy-4" style="text-align: center;">
        <div class="col-lg-12 col-md-12 footer-info" >
          <a href="index.html" class="logo align-items-center">
            <span >YG1BSH</span>
          </a>
          <!-- <p class="logo d-flex">YG1BSH</p> -->
          <p>Indonesian Amateur Radio</p>
          <!-- <div class="social-links d-flex mt-4">
            <a href="#" class="twitter"><i class="bi bi-twitter"></i></a>
            <a href="#" class="facebook"><i class="bi bi-facebook"></i></a>
            <a href="#" class="instagram"><i class="bi bi-instagram"></i></a>
            <a href="#" class="linkedin"><i class="bi bi-linkedin"></i></a>
          </div> -->
        </div>

        <!-- <div class="col-lg-2 col-6 footer-links">
          <h4>Useful Links</h4>
          <ul>
            <li><a href="#">Home</a></li>
            <li><a href="#">About me</a></li>
            <li><a href="#">QRZ.COM</a></li>
            <li><a href="#">LOTW</a></li>
            <li><a href="#">Privacy policy</a></li>
          </ul>
        </div>

        <div class="col-lg-2 col-6 footer-links">
          <h4>Our Services</h4>
          <ul>
            <li><a href="#">Web Design</a></li>
            <li><a href="#">Web Development</a></li>
            <li><a href="#">Product Management</a></li>
            <li><a href="#">Marketing</a></li>
            <li><a href="#">Graphic Design</a></li>
          </ul>
        </div>

        <div class="col-lg-3 col-md-12 footer-contact text-center text-md-start">
          <h4>Contact Us</h4>
          <p>
            A108 Adam Street <br>
            New York, NY 535022<br>
            United States <br><br>
            <strong>Phone:</strong> +1 5589 55488 55<br>
            <strong>Email:</strong> info@example.com<br>
          </p>

        </div> -->

      </div>
    </div>

    <div class="container mt-4">
      <div class="copyright">
        &copy; Copyright <strong><span>Logis</span></strong>. All Rights Reserved
      </div>
      <div class="credits">
        Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
      </div>
    </div>
</footer>
  <!-- End Footer -->

  
  <a href="#" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>
  <script src="qslcard.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.js"></script>




  <script type="text/javascript">
    const domain = document.location.origin;
    const params = new URLSearchParams(document.location.search);
    let callsign = params.get("callsign");
    let token = params.get("token");
    
    // console.log('domain: ', domain);

    // console.log('entered callsign: ', callsign);

    // const apiUrl = 'https://script.google.com/macros/s/AKfycbzhrzuEosD7zJTwK5KXI-ioRG5rdVLK_yvkzqRdL1QK2DIVTDLujmLqg1C0atM9CNI/exec';
    const btnSearch = document.getElementById('btnSearch');
    let judulKolom = [];
    let qsoData = [];
    let callsignData = [];
    let summaryData = {};
    let dxcc = document.querySelector('#dataDXCC');
    let qso = document.querySelector('#dataQSO');
    let call = document.querySelector('#dataCallsign');
    // let mode = document.querySelector('#dataMode');
    // let band = document.querySelector('#dataBand');
    
    // console.log('dxcc: ', dxcc.dataset.purecounterEnd);
    // dxcc.dataset.purecounterEnd = '200';
    // let xdxcc = '300';
    

    // const o = params.get("o");
    // console.info(s); //show C
    // console.log('callsign: ', callsign);

    // getQSOData('JR2IGV');
    // console.log('callsign: ', callsign);
    // console.log('token: ', token);
    callsign != null ? getQSOData(callsign) : '' ;
    token != null ? getTokenData(token) : '' ;

    window.jsPDF = window.jspdf.jsPDF;
    
	  btnSearch.addEventListener('click', function(){
        callsign = document.getElementById('callsign').value.toUpperCase();
        document.getElementById('qsoDetail').innerHTML = '';
        if (callsign != '' && callsign.length > 3) { 
          // console.log('callsign: ', callsign);
          getQSOData(callsign);
        }
    })

    getSummaryData();
    function getSummaryData() {
      document.getElementById("note").textContent = `Last update: `;
            // const apiUrl    = 'https://script.google.com/macros/s/AKfycbyypbdXfKT34_tsl_cz5OyL5MQs4nvMH1kXXmFi8V0dyrYxPujIxqSIWt77wg3XQlXA/exec';
            const action    = '?action=read';
            const callsign  = '&callsign=summary'; 
            $.ajax({
              url : apiUrl+action+callsign,
              
              method : "GET",
              success: function(data){
                // console.log(JSON.parse(JSON.stringify(data)));
                summaryData = JSON.parse(JSON.stringify(data.records[0]));
                console.log(summaryData);
                const dateUpdate = summaryData.DATE_UPDATE.substring(0,10);
                const timeUpdate = summaryData.TIME_UPDATE.substring(11,19);
                document.getElementById("note").textContent = `Last update: ${dateUpdate} ${timeUpdate}`;
                dxcc.textContent  = summaryData.DXCC;
                call.textContent  = summaryData.CALLSIGN;
                qso.textContent  = summaryData.QSO;
                // mode.textContent  = summaryData.MODE;
                // band.textContent  = summaryData.BAND;
                if (summaryData.length > 0) {
                    // $('#dataDXCC').innerHTML = summaryData.DXCC;
                    // document.getElementById("dataDXCC").textContent = summaryData.DXCC;
                    // document.getElementById("dataDXCC").text = summaryData.DXCC;
                    // dxcc.dataset.purecounterEnd = summaryData.DXCC;
                    // 
                    // judulKolom = setJudulKolom(qsoData);
                    // console.log('judulKolom: ', judulKolom);
                    // showAdifData(qsoData, judulKolom);
                    // showSummaryData(qsoData);
                }
              },
              error : function(request, status, error) {
                console.log(error);
              }
            });
        }

    // getQSOData(callsign)
    function getQSOData(call) {
            // const apiUrl    = 'https://script.google.com/macros/s/AKfycbwY0umafNVZqRd9Py5dgJbxp20-V7DP9QMj5jd3-zffU8x9fvsZIEpbuMZCscGhQcXz/exec';
            document.getElementById('callsignData').innerHTML = '';
            document.getElementById('qsoDetail').innerHTML = '';
            const action    = '?action=read';
            const callsign  = '&callsign='+call; 
            document.querySelector('#qsodataspan').textContent = call + ' QSO DATA';
            document.querySelector('#qsodatahead').textContent = call + ' QSO DATA';
            $.ajax({
              url : apiUrl+action+callsign,
              
              method : "GET",
            //   data : {edit_data: jsonData},
                // data: function() {
                //                 action = 'read';
                                
                // },
              success: function(data){
                //alert(data);
                console.log('qsoData: ', data);
                qsoData = JSON.parse(JSON.stringify(data.records[1]));
                callsignData = JSON.parse(JSON.stringify(data.records[0][0]));
                // console.log(callsignData);
                let callsignData1 = callsignData[1] != null ? callsignData[1] : '';
                let callsignData2 = callsignData[2] != null ? callsignData[2] + ' - ' : '';
                let callsignData3 = callsignData[3] != null ? callsignData[3] : ''; 

                // let html = `${callsignData[1]} ${callsignData[2]} - ${callsignData[3]}`;
                let html = `${callsignData1} ${callsignData2} ${callsignData3}`;
                document.getElementById('callsignData').innerHTML = html;

                // console.log('qsoData: ', qsoData);
                if (qsoData.length > 0) {
                    judulKolom = setJudulKolom(qsoData);
                    // console.log('judulKolom: ', judulKolom);
                    // showAdifData(qsoData, judulKolom);
                    document.querySelector('#qsodataspan').textContent = call + ' QSO DATA (' + qsoData.length + ')';
                    document.querySelector('#qsodatahead').textContent = call + ' QSO DATA (' + qsoData.length + ')';
                    showQSODetail(qsoData, callsignData);
                } else {
                  document.getElementById('qsoDetail').innerHTML = 
                    `<div class="col-lg-12 d-flex align-items-center justify-content-center">`+
                      `<h2 style="color: red";><strong>Sorry, no QSO Data</strong></h2>`+
                      `</div>`;
                }
              },
              error : function(request, status, error) {
                console.log(error);
              }
            });
        }

    // getQSOData(callsign)
    function getTokenData(token) {
      // document.getElementById('dataqso').scrollIntoView();
      window.location.hash = '#footer'
      const atob_token = atob(token);
      // console.log('token: ', token, ' / ', atob_token);
      (atob_token.length > 5) ? verifyToken(atob_token) : (
              document.getElementById('qsoDetail').innerHTML = 
                    `<div class="col-lg-12 d-flex align-items-center justify-content-center">`+
                      `<h2 style="color: red";><strong>Sorry, the QRCode is not valid !!!</strong></h2>`+
                    `</div>`);
    }

    function verifyToken(token) {
      // const apiUrl    = 'https://script.google.com/macros/s/AKfycbwY0umafNVZqRd9Py5dgJbxp20-V7DP9QMj5jd3-zffU8x9fvsZIEpbuMZCscGhQcXz/exec';
            // const apiUrl    = 'https://script.google.com/macros/s/AKfycbwY0umafNVZqRd9Py5dgJbxp20-V7DP9QMj5jd3-zffU8x9fvsZIEpbuMZCscGhQcXz/exec';
            // document.getElementById('callsignData').innerHTML = '';
            // console.log('token to send: ', token);
            document.getElementById('qsoDetail').innerHTML = '';
            const action    = '?action=read';
            const paramToken  = '&token='+token; 
            document.querySelector('#qsodataspan').textContent = '';
            document.querySelector('#qsodatahead').textContent = '';
            $.ajax({
              url : apiUrl+action+paramToken,
              
              method : "GET",
            //   data : {edit_data: jsonData},
                // data: function() {
                //                 action = 'read';
                                
                // },
              success: function(data){
                //alert(data);
                // console.log('rawData: ', data);
                qsoData.push(JSON.parse(JSON.stringify(data.records[1])));
                callsignData = JSON.parse(JSON.stringify(data.records[0][0]));
                // console.log('qsoData: ', qsoData);
                // console.log('callsignData: ', callsignData);
                

                // let btoa_id = btoa(data.ROW_ID);
                // var qrcode = new QRCode(`qrcode`, {
                //     text: `${href}`,
                //     width: 128,
                //     height: 128,
                //     colorDark : "#000000",
                //     colorLight : "#ffffff",
                //     correctLevel : QRCode.CorrectLevel.H
                // });
                
                let html = `${callsignData[1]} ${callsignData[2]} - ${callsignData[3]}`;
                document.getElementById('callsignData').innerHTML = html;

                // console.log('qsoData length: ', qsoData['CALL']);
                // generatePDFQSLCard = (qsoData, callsignData);
                // generatePDFQSLCard(qsoData, callsignData);
                if (qsoData.length > 0) {
                    judulKolom = setJudulKolom(qsoData);
                    // console.log('judulKolom: ', judulKolom);
                    // console.log('qsoData: ', qsoData);
                    // showAdifData(qsoData, judulKolom);
                    document.querySelector('#qsodataspan').textContent = callsignData[0] + ' QSO DATA';
                    document.querySelector('#qsodatahead').textContent = callsignData[0] + ' QSO DATA';
                    showQSODetail(qsoData, callsignData, 1);
                    // generatePDFQSLCard(qsoData, callsignData);
                } else {
                  document.getElementById('qsoDetail').innerHTML = 
                    `<div class="col-lg-12 d-flex align-items-center justify-content-center">`+
                      `<h2 style="color: red";><strong>Sorry, the QRCode is not valid !!!</strong></h2>`+
                    `</div>`;
                }
              },
              error : function(request, status, error) {
                console.log(error);
              }
            });
        }

        setJudulKolom = (data) => {
            let judul = [];
            // console.log(data.length);
            // console.log(Object.keys(data)); 

            for (let x=0; x < data.length; x++) {
                let temp = Object.keys(data[x]);
                judul = judul.concat(temp);
            }
            // filter unique judul kolom
            judul = judul.filter((item, pos) => judul.indexOf(item) === pos);
            // console.log(judul);
            return judul;
        }

        

        function showQSODetail(data, callsign, type=0) {
            // console.log('qsoData.length: ', data.length);
            // console.log('dataCallsign: ', callsign);
            let delay = 100;
            let html = '';
            let featured, mt_4, warna_text ;
            // html += `<p>${callsign[1]} ${callsign[2]} - ${callsign[3]}</p>`;
            
            html = '';
            let isHide = type == 1 ? " style='display:none' " : "  style='display:block'  ";
            let lebarCol = type == 1 ? " col-lg-12 " : " col-lg-9 ";
            for (let i=0; i<data.length; i++) {
                let thn = data[i].QSO_DATE.toString().substring(0,4);
                let bln = getMonthName(data[i].QSO_DATE.toString().substring(4,6));
                let tgl = data[i].QSO_DATE.toString().substring(6,8);

                let jam = data[i].TIME_ON.toString().substring(0,2);
                let mnt = data[i].TIME_ON.toString().substring(4,6);
                // let rst = data[i].RST_SENT.toFixed(3);
                let freq = data[i].FREQ.toFixed(3);

                // console.log(tgl,'-',bln,'-', thn);
                // console.log('oke ..');
                mt_4 = (i == 0) ? '' : 'mt-4';
                featured    = (i % 2 == 0) ? '' : 'featured';
                warna_text  = (i % 2 == 0) ? 'black' : 'white';
                html += 
                    `<div class="row gy-4 pricing-item ${featured} ${mt_4}" data-aos="fade-up" data-aos-delay="${delay}">`+
                        `<div class="${lebarCol} d-flex align-items-center justify-content-center">`+
                            `<table width="100%" style="color: ${warna_text};">`+
                                '<thead style="text-align: center; ">'+
                                    `<th>DATE</th>`+
                                    '<th>TIME (UTC)</th>'+
                                    '<th>MODE</th>'+
                                    '<th>BAND</th>'+
                                    '<th>FREQ</th>'+
                                    '<th>RST</th>'+
                                    // '<th hidden>qrCode</th>'+
                                '</thead>'+
                                '<tbody style="text-align: center">'+
                                    `<td>${tgl} ${bln} ${thn}</td>`+
                                    `<td>${jam}:${mnt}</td>`+
                                    `<td>${data[i].MODE}</td>`+
                                    `<td>${data[i].BAND}</td>`+
                                    `<td>${freq}</td>`+
                                    `<td>${data[i].RST_SENT}<div hidden id="qrcode${data[i].ROW_ID}"></div></td>`+
                                    // `<td hidden><div id="qrcode${data[i].ROW_ID}"></div></td>`+
                                '</tbody>'+
                            '</table>'+
                        '</div>'+
                        `<div class="col-lg-3 d-flex align-items-center justify-content-center" ${isHide}>`+
                            // '<div class="text-center"><a href="#" class="buy-btn">QSL Card</a></div>'+
                            `<button type="button" data-id="${data[i].ROW_ID}" onclick="downloadQSL(this)" class="btn buy-btn text-center" ${isHide}>QSL Card</button>`+
                        '</div>'+
                    '</div>';
                delay += 100;
            }
            document.getElementById('qsoDetail').innerHTML = html;

            for (let i=0; i<data.length; i++) {
              let btoa_id = btoa(data[i].TOKEN);
              const textContent = `${domain}/index.html?token=${btoa_id}`; 
              // console.log(`qrcode: ${textContent}`);
              var qrcode = new QRCode(`qrcode${data[i].ROW_ID}`, {
                  text: `${textContent}`,
                  width: 128,
                  height: 128,
                  colorDark : "#000000",
                  colorLight : "#ffffff",
                  correctLevel : QRCode.CorrectLevel.L
              });
            }
        }

        downloadQSL = (e) => {
          let row_id = $(e).attr('data-id');
          const data = qsoData.filter(d => d.ROW_ID === row_id)[0] ;
          generatePDFQSLCard(data, callsignData);          
        }

        generatePDFQSLCard = (data, calldata) => {

          // document.getElementById('qrcode').innerHTML = '';

          // console.log('data for QSLCard: ', data);
          let thn = data.QSO_DATE.toString().substring(0,4);
          let bln = getMonthName(data.QSO_DATE.toString().substring(4,6));
          let tgl = data.QSO_DATE.toString().substring(6,8);
          let tanggal = tgl+' '+bln+' '+thn;

          let jam   = data.TIME_ON.toString().substring(0,2);
          let mnt   = data.TIME_ON.toString().substring(4,6);
          let waktu = jam+':'+mnt;
          let freq  = data.FREQ.toFixed(3);
          let band  = data.BAND;
          let mode  = data.MODE;
          let rst   = (data.RST_SENT).toString();

          let calldata1 = calldata[1] != null ? calldata[1] : '';
          let calldata2 = calldata[2] != null ? calldata[2] + ' - ' : '';
          let calldata3 = calldata[3] != null ? calldata[3] : ''; 

          var fileName = 'qslcard.pdf';
          var brsCallsign = 80;
          var brsQSOData  = 116;

          var doc = new jsPDF(
            {
              orientation: 'l',
              unit: 'mm',
              format: 'a5',
              putOnlyUsedFonts:true
            }
          );
          const qslcardTemplate = "assets/img/QSLCard Template-1.png";
      
          var pageSize = doc.internal.pageSize; 

          doc.addImage(qslcardTemplate, 'JPG', 0, 0, pageSize.width, pageSize.height); 

          var base64Image = $(`#qrcode${data.ROW_ID}`).find('img').prop("src");
          
          doc.setDrawColor(255,255,255);  // line color (white)
          doc.setFillColor(255,255,255);  // fill color (white)
          doc.rect(pageSize.width-27,pageSize.height-25,21,21, 'F');

          doc.setDrawColor(255,0,0);
          doc.addImage(base64Image , 'png', pageSize.width-25, pageSize.height-23, 17, 17);  // src, left, top, width, height
          doc.setFont("Helvetica", "Bold");
          doc.setTextColor('red');
          doc.setFontSize(48);
          doc.text(data.CALL, pageSize.width/2, 80, 'center');
          
          doc.setTextColor('blue');
          doc.setFont("helvetica", "bold");
          doc.setFontSize(24);
          doc.text(calldata1+' '+calldata2, pageSize.width/2, 90, 'center');

          doc.setFontSize(14);
          doc.text(tanggal, 31, brsQSOData, 'center');
          doc.text(waktu, 66, brsQSOData, 'center');
          doc.text(band, 103, brsQSOData, 'center');
          doc.text(freq, 128, brsQSOData, 'center');
          doc.text(mode, 156, brsQSOData, 'center');
          doc.text(rst, 185, brsQSOData, 'center');

          window.open(doc.output('bloburl', fileName));
        }
        

        // Convert HTML content to PDF
        function Convert_HTML_To_PDF() {
            var doc = new jsPDF();
          
            // Source HTMLElement or a string containing HTML.
            var elementHTML = document.querySelector("#contentToPrint");

            doc.html(elementHTML, {
                callback: function(doc) {
                    // Save the PDF
                    doc.save('document-html.pdf');
                },
                margin: [10, 10, 10, 10],
                autoPaging: 'text',
                x: 0,
                y: 0,
                width: 190, //target width in the PDF document
                windowWidth: 675 //window width in CSS pixels
            });
        }

        function getMonthName(monthNumber) {
          const date = new Date();
          date.setMonth(monthNumber - 1);

          return date.toLocaleString('en-US', {
              month: 'short',
          });
        }

        $(document).ready(function() {
            
        })
  </script>

</body>

</html>